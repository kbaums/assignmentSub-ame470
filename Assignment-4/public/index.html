<!doctype html>
<html>
<head>

  <meta name='viewport' content="initial-scale=1.0, user-scalable=no, width=device-width, maximum-scale=1.0">
  <script src='asyncReq.js'> </script>
  <script>
    function addNew(){
      var name = prompt("Enter the image name:");
      var photoURL = prompt("Enter the image URL:");
      var id = new Date().getTime();
      
      if(photoURL.indexOf("http") >=0 && photoURL.length > 10){
        var url = "./addTodo" + "?id=" + id + "&name=" + name + "&url=" + photoURL;
        loadFile(url ,function(d){
          formatTodos(JSON.parse(d));
        });

      }

    }

    function deleteTodo(index){
      var flag = confirm("Are you sure you want to delete?");
      if(flag){
        var url = "./deleteTodo" + "?id=" + index;
        loadFile(url ,function(d){
          formatTodos(JSON.parse(d));
        });
      }
    }

    function formatTodos(list)
    {
      var markup = "";
      if(list.length == 0){
        markup = "No pictures yet"
        document.getElementById("todoListWrapper").innerHTML = markup;
        return;
      }
      else{
        for(var i = 0; i < list.length; i++){
          markup += "<li class='selectable' id='" + list[i].id + "'><div>" + list[i].name + "</div><div class = 'box'><div class='thumb'; onclick='imageSelect("
          + list[i].id + ")'; style='background-image:url(" + list[i].url + ");'> </div></div></div></li>"; 
        }
      }
      document.getElementById("todoListWrapper").innerHTML = markup;
      imageSelect(list[0].id);
    }

    /*function showImage(item) {
      var image = "url(" + item + ")";
      document.getElementById("largeImage").style.backgroundImage = image;
    }*/

    /*function showImage(item, subtitle, index) {
      var image = "<div> <img src=" + item + "> </br><h2>" + subtitle + "</h2>";

      var photos = document.getElementsByClassName("selectable");

      var id = index;

      for(i = 0; i < photos.length; i++) {
        photos[i].style.backgroundColor = 'white';
      }

      document.getElementById(id).style.backgroundColor = '#d2f6f9';

      document.getElementById("largeImage").style.backgroundImage = "url(" + item + );
    }*/

    var currSel = 0;
    function imageSelect(id) {
      currSel = id;

      var photos = document.getElementsByClassName("selectable");

      for(i = 0; i < photos.length; i++) {
        photos[i].style.backgroundColor = 'white';
      }

      document.getElementById(id).style.backgroundColor = '#d2f6f9';


      var url = "./getPhoto?id=" + id;
      loadFile(url ,function(d) {
        var data = JSON.parse(d);
        document.getElementById("theTitle").innerHTML = data.name;
        document.getElementById("largeImage").innerHTML = "<img class='enlarge' src=" + data.url + ">";
      });
    }

    function rename() {
      var id = index;
      var name = prompt("Enter the image name:");
      var url = "./renamePhoto" + "?id=" + id + "&name=" + name;
        loadFile(url ,function(d){
          formatTodos(JSON.parse(d));
        });
    }

    function start()
    {
      var url = "./getTodos";
      loadFile(url ,function(d){
        console.log(d);
        formatTodos(JSON.parse(d));
      })
    }
  </script>
  <style>
      h1{
        text-align: center;
      }
      #addButton
      {
        position: absolute;
        top: 20px;
        right: 20px;
      }
      .delButton
      {
          float: right;
          width: 36px;
          height: 28px;
      }      
      .thumb{
          height:60px;
          width:60px;
          background-position: 50%;
          background-size: cover;
      }

      .enlarge {
        max-width: 80%;
        max-height: 80%;
        background-position: 50%;
        background-size: cover;
      }

      .box {
        display: inline-flex;
      }

      .space {
        padding-left: 3%;
        align-content: center;
      }

      #todoListWrapper {
        list-style: none;
      }

      .selected {
        background-color: #d2f6f9;
      }

      .left {
        float: left;
        width: 50%;
      }

      .right {
        float: right;
        width: 47%;
        padding-left: 3%;
      }

      @media (max-width: 400px) {
        .left {
          width: 100%;
          margin-bottom: 1%;
        }

        .right {
          width: 100%;
          margin-top: 1%;
          padding-left: 0%;
        }
      }

      /*@media (min-width: 400px) and (max-width: 800px) {
        
      }

      @media (min-width: 800px) {

      }*/

      
  </style>
</head>

<body onload='start()'>
  <h1> My Image Collection </h1>
  <button id='addButton' onclick='addNew()'> + </button>
   <div class="left">
    <ol id='todoListWrapper'> </ol>
       <!--<img src="">-->
    </div>
   <div class="right" class="space">
      <div id="largeImage" class='enlarge'></div>
      <h2 id="theTitle"></h2>
      <button onclick='deleteImage()'> Delete </button>
      <button onclick='rename()'> Rename </button>
   </div>
  
</body>

</html>