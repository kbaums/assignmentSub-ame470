<!doctype html>
<html>
<head>
  <script src='asyncReq.js'> </script>
  <script>
    function addNew(){
      var name = prompt("Enter the image name:");
      var photoURL = prompt("Enter the image URL:");
      var id = new Date().getTime();
      
      if (name != null && photoURL != null){
        var url = "./addTodo" + "?id=" + id + "&name=" + name + "&url=" + photoURL;
        loadFile(url ,function(d){
          formatTodos(JSON.parse(d));
        });

      }

    }

    function deleteTodo(index){
      var flag = confirm("Are you sure you want to delete?");
      if(flag){
        var url = "./deleteTodo" + "?id=" + index;
        loadFile(url ,function(d){
          formatTodos(JSON.parse(d));
        });
      }
    }

    function formatTodos(list)
    {
      var markup = "";
      if(list.length == 0){
        markup = "No pictures yet"
      }
      else{
        for(var i = 0; i < list.length; i++){
          markup += "<li class='selectable' id='" + list[i].id + "'><div>" + list[i].name + "</div><div class = 'box'><div class='thumb'; onclick='showImage(\"" + list[i].url + "\", \"" + list[i].name + "\", \"" + list[i].id + "\")'; style='background-image:url(" + list[i].url + ");'> </div>" +
            "<div class='space'></div><button class='delButton' onclick='deleteTodo(" + list[i].id + ")'> X </button></div>"+
            "</li>"; 
        }
      }
      document.getElementById("todoListWrapper").innerHTML = markup;
    }

    /*function showImage(item) {
      var image = "url(" + item + ")";
      document.getElementById("largeImage").style.backgroundImage = image;
    }*/

    function showImage(item, subtitle, index) {
      var image = "<div> <img src=" + item + "> </br><h2>" + subtitle + "</h2> <button onclick='rename(\"" + index + "\")'>Rename</div>";

      var photos = document.getElementsByClassName("selectable");

      var id = index;

      for(i = 0; i < photos.length; i++) {
        photos[i].style.backgroundColor = 'white';
      }

      document.getElementById(id).style.backgroundColor = '#d2f6f9';

      document.getElementById("largeImage").innerHTML = image;
    }

    function rename(index) {
      var id = index;
      var name = prompt("Enter the image name:");
      var url = "./renamePhoto" + "?id=" + id + "&name=" + name;
        loadFile(url ,function(d){
          formatTodos(JSON.parse(d));
        });
    }

    function start()
    {
      var url = "./getTodos";
      loadFile(url ,function(d){
        console.log(d);
        formatTodos(JSON.parse(d));
      })
    }
  </script>
  <style>
      h1{
        text-align: center;
      }
      #addButton
      {
        position: absolute;
        top: 20px;
        right: 20px;
      }
      .delButton
      {
          float: right;
          width: 36px;
          height: 28px;
      }      
      .thumb{
          height:60px;
          width:60px;
          background-position: 50%;
          background-size: cover;
      }

      .enlarge {
        width: 300px;
        height: 300px;
        background-position: 50%;
        background-size: cover;
      }

      .box {
        display: inline-flex;
      }

      .space {
        width: 400px;
      }

      #todoListWrapper {
        list-style: none;
      }
      
  </style>
</head>

<body onload='start()'>
  <h1> My Image Collection </h1>
  <button id='addButton' onclick='addNew()'> + </button>
   <div style="float:left; width:50%">
    <ol id='todoListWrapper'> </ol>
       <!--<img src="">-->
    </div>
   <div style="float:right; width:50%" >
      <div id="largeImage" class='enlarge'> </div>
   </div>
  
</body>

</html>